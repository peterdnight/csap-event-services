db.eventRecords.aggregate([
        {
            $match:{
                appId:"csapssp.gen",
                project:"SNTC and PSS",
                lifecycle:"dev",
                category:"/csap/reports/jmx/daily",
                "createdOn.date":{
                    $gte:"2016-03-27",
                    $lte:"2016-04-11"
                },
                "data.summary":{
                    $elemMatch:{
                    
            $or: [
                {"serviceName":"ILoadBalancer"},
                {"serviceName":"SsueService"}
                ]
                    }
                }
            }
        },
        {
            $unwind:"$data.summary"
        },
        {
            $match:{
            $or: [
                {"data.summary.serviceName":"ILoadBalancer"},
                {"data.summary.serviceName":"SsueService"}
                ]
            }
        },
        {
            $group:{
                _id:{
                    lifecycle:"$lifecycle",
                    date:"$createdOn.date",
                    appId:"$appId",
                    host:"$host",
                    project:"$project",
                    serviceName:"$data.summary.serviceName"
                },
                sessionsCount:{
                    $sum:"$data.summary.httpRequestCount"
                },
                numberOfSamples:{
                    $sum:"$data.summary.numberOfSamples"
                }
            }
        },
        {
            $project:{
                appId:1,
                lifecycle:1,
                project:1,
                serviceName:1,
                date:1,
                sessionsCount:1,
                numberOfSamples:{
                    $cond:[
                        {
                            $eq:[
                                "$numberOfSamples",
                                0
                            ]
                        },
                        1,
                        "$numberOfSamples"
                    ]
                }
            }
        },
        {
            $group:{
                _id:{
                    lifecycle:"$_id.lifecycle",
                    date:"$_id.date",
                    appId:"$_id.appId",
                    project:"$_id.project",
                    serviceName:"$_id.serviceName"
                },
                sessionsCount:{
                    $sum:"$sessionsCount"
                },
                numberOfSamples:{
                    $sum:"$numberOfSamples"
                }
            }
        },
        {
            $project:{
                sessionsCount:1,
                appId:"$_id.appId",
                lifecycle:"$_id.lifecycle",
                project:"$_id.project",
                serviceName:"$_id.serviceName",
                date:"$_id.date",
                _id:0
            }
        },
        {
            $project:{
                appId:1,
                lifecycle:1,
                project:1,
                serviceName:1,
                date:1,
                sessionsCount:1,
                numberOfSamples:{
                    $cond:[
                        {
                            $eq:[
                                "$numberOfSamples",
                                0
                            ]
                        },
                        1,
                        "$numberOfSamples"
                    ]
                }
            }
        },
        {
            $sort:{
                date:1
            }
        },
        {
            $group:{
                _id:{
                    lifecycle:"$lifecycle",
                    appId:"$appId",
                    project:"$project",
                    serviceName:"$serviceName"
                },
                date:{
                    $push:"$date"
                },
                sessionsCount:{
                    $push:"$sessionsCount"
                }
            }
        },
        {
            $project:{
                sessionsCount:1,
                serviceName:"$_id.serviceName",
                appId:"$_id.appId",
                lifecycle:"$_id.lifecycle",
                project:"$_id.project",
                date:1,
                _id:0
            }
        }
    ]
    )